= cqfdrc(5)
:doctype: manpage
:author: Gaël PORTAY
:email: gael.portay@savoirfairelinux.com
:lang: en
:man manual: C.Q.F.D. Manual
:man source: C.Q.F.D. Project

== NAME

cqfdrc - project information config file

== DESCRIPTION

The _.cqfdrc_ file at the root of your project contains the information
required to support project tooling.

It is written in an .ini-like format.

=== THE PROJECT SECTION

**org**::
    a short, lowercase name for the project’s parent organization.

**name**::
    a short, lowercase name for the project.

**build_context** (optional)::
    a directory to pass as the build context to *docker(1)*. This should be
    specified relatively to where cqfd is invoked. For example, it can be set
    to _._, to use the current working directory of the invoked *cqfd(1)*
    command as the *docker(1)* build context, which can be useful when files at
    the root of the project are required to build the image. When using this
    option, a _.dockerignore_ file can be useful to limit what gets sent to the
    *docker(1)* daemon.

**custom_img_name** (optional)::
    allows specifying a custom **docker(1)** image name instead of the one
    automatically generated by cqfd. You can also include a private repository
    _URL_ in the image name. If you do, **cqfd(1)** will try to pull the image
    from the provided repository, if not already available on your system.

    Unless _custom_img_name_ is used, *docker(1)* images generated by *cqfd(1)*
    will be named _cqfd\_$username\_$org\_$name\_$hash_, using the following
    variables:

    **$username**::
        The UNIX username used to launch *cqfd(1)*.

    **$org**::
        The _org_ variable in the _[project]_ section of your _.cqfdrc_.

    **$name**::
        The _name_ variable in the _[project]_ section of your _.cqfdrc_.

    **$hash**::
        A hash of the local _Dockerfile_.

=== THE BUILD SECTION

**command**::
    the command string to be executed when cqfd is invoked. This string will be
    passed as an argument to a classical _sh -c "commands"_, within the build
    container, to generate the build artefacts.

**files**::
    an optional space-separated list of files generated by the build process
    that we want to include inside a standard release archive.

**distro**::
    the name of the directory containing the _Dockerfile_. By default,
    *cqfd(1)* uses *docker(1)*, and _.cqfd/docker/Dockerfile_ is used.

**user_extra_groups**::
    an optional, space-separated list of groups the user should be a member of
    in the container. You can either use the _group:gid_ format, or simply
    specify the _group_ name if it exists either in the host or inside the
    *docker(1)* image.

**flavors** (optional)::
    the list of build flavors (see below). Each flavor has its own command just
    like _build.command_. This property is now automatically deduced from the
    flavors sections of _.cqfdc_.

**docker_build_args** (optional)::
    arguments used to invoke *docker-build(1)*. For example, to attempt to pull
    newer version of the image, it can be set like:
    `docker_build_args='--pull=true'`

**docker_run_args** (optional)::
    arguments used to invoke *docker-run(1)*. For example, to share networking
    with the host, it can be set like:
    `docker_run_args='--network=host'`

**archive**::
    the optional name of the release archive generated by *cqfd(1)*. You can
    include environment variable names, as well as the following template
    marks:
    * *%Gh* - *git(1)* short hash of last commit
    * *%GH* - *git(1)* long hash of last commit
    * *%D3* - RFC3339 date (YYYY-MM-DD)
    * *%Du* - Unix timestamp
    * *%Cf* - current cqfd flavor name (if any)
    * *%Po* - value of the _project.org_ configuration key
    * *%Pn* - value of the _project.name_ configuration key
    * *%%* - a litteral _%_ sign

By default, cqfd will generate a release archive named _org-name.tar.xz_, where
_org_ and _name_ come from the project's configuration keys. The _.tar.xz_,
_.tar.gz_ and _.zip_ archive formats are supported.

For _tar_ archives:

* Setting _tar_transform=yes_ will cause all files specified for the archive to
  be stored at the root of the archive, which is desired in some scenarios.

* Setting _tar_options_ will pass extra options to the *tar(1)* command. For
  example, setting _tar_options=-h_ will copy all symlink files as hardlink,
  which is desired in some scenarios.


== COMMENT

The _.cqfdrc_ file supports Unix shell comment; the words after the character
_#_ are ignored up to the end of line. A comment cannot be set in the first
line, and after a section.

== EXAMPLES

Here is a sample *.cqfdrc(5)* file:

    [project]
    org='fooinc'
    name='buildroot'

    [build]
    command='make foobar_defconfig && make && asciidoc README.FOOINC'
    files='README.FOOINC output/images/sdcard.img'
    archive='cqfd-%Gh.tar.xz'

== BUGS

Report bugs at *https://github.com/savoirfairelinux/cqfd/issues*

== AUTHOR

Originally written by Mathieu Audat *mathieu.audat@savoirfairelinux.com*

== COPYRIGHT

Copyright (C) 2015-2025 Savoir-faire Linux, Inc.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, version 3.

== SEE ALSO

*cqfd(1)*
